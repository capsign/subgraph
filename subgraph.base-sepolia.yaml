specVersion: 1.0.0
schema:
  file: ./schema.graphql
dataSources:
  # Diamond Factory - tracks all diamond creation
  - kind: ethereum/contract
    name: DiamondFactory
    network: base-sepolia
    source:
      address: "0x801f27B0d9b238D7E81cBc4141cc49A17a644e21"
      abi: DiamondFactory
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Diamond
        - Wallet
        - Offering
        - ShareClass
        - UserRole
      abis:
        - name: DiamondFactory
          file: ./abis/DiamondFactory.json
        - name: FactoryCoreFacet
          file: ./abis/FactoryCoreFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
      eventHandlers:
        - event: DiamondCreated(indexed address,indexed address,indexed bytes32)
          handler: handleDiamondCreated
        - event: FacetRegistryUpdated(indexed address)
          handler: handleFacetRegistryUpdated
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
          receipt: false
      file: ./src/mappings/diamond-factory.ts
  
  # EAS - tracks attestations (DEPRECATED - kept for backward compatibility)
  # New compliance data is tracked via ComplianceAdminFacet events in offering diamonds
  # - kind: ethereum/contract
  #   name: EAS
  #   network: base-sepolia
  #   source:
  #     address: "0x4200000000000000000000000000000000000021"
  #     abi: EAS
  #     startBlock: 31965997
  #   mapping:
  #     kind: ethereum/events
  #     apiVersion: 0.0.7
  #     language: wasm/assemblyscript
  #     entities:
  #       - Attestation
  #       - Wallet
  #     abis:
  #       - name: EAS
  #         file: ./abis/EAS.json
  #     eventHandlers:
  #       - event: Attested(indexed address,indexed address,bytes32,indexed bytes32)
  #         handler: handleAttested
  #       - event: Revoked(indexed address,indexed address,bytes32,indexed bytes32)
  #         handler: handleRevoked
  #     file: ./src/mappings/attestations.ts

  # FacetRegistry - tracks facet registration and deployment
  - kind: ethereum/contract
    name: FacetRegistry
    network: base-sepolia
    source:
      address: "0x7835CE482068592bC6761522c53A2665a409398C"
      abi: FacetRegistry
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Facet
        - FacetRegistryEvent
      abis:
        - name: FacetRegistry
          file: ./abis/FacetRegistry.json
      eventHandlers:
        - event: FacetRegistered(string,indexed uint256,indexed address,uint256)
          handler: handleFacetRegistered
        - event: FacetRemoved(string,indexed uint256)
          handler: handleFacetRemoved
      file: ./src/mappings/facet-registry.ts

  # WalletFactory - tracks wallet creation with owner types (Permissionless)
  - kind: ethereum/contract
    name: WalletFactory
    network: base-sepolia
    source:
      address: "0xC8528af35a995be186B38f76Bf9Fa7Bcd27f9DC0"
      abi: WalletFactory
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Diamond
        - UserRole
      abis:
        - name: WalletFactory
          file: ./abis/WalletFactory.json
        - name: WalletFactoryCoreFacet
          file: ./abis/WalletFactoryCoreFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: WalletCreated(indexed address,indexed address,uint8,indexed bytes32,address)
          handler: handleWalletCreated
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/wallet-factory.ts

  # OfferingFactory - tracks offering creation (Permissionless)
  - kind: ethereum/contract
    name: OfferingFactory
    network: base-sepolia
    source:
      address: "0xf42904CbCf95707CD42E1cBA1CF59f10d8B4a966"
      abi: OfferingFactory
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
        - UserRole
      abis:
        - name: OfferingFactory
          file: ./abis/OfferingFactory.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: OfferingCreated(indexed address,indexed address,indexed address,address[])
          handler: handleOfferingCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
        - event: DiscountSet(indexed address,uint256)
          handler: handleDiscountSet
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/offering-factory.ts

  # TokenFactory - tracks token creation (Permissionless)
  - kind: ethereum/contract
    name: TokenFactory
    network: base-sepolia
    source:
      address: "0x1bcE01F79Fdf62EA681e1Db2Fa28EA51053eE635"
      abi: TokenFactory
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ShareClass
        - Safe
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
        - UserRole
      abis:
        - name: TokenFactory
          file: ./abis/TokenFactory.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: DiamondLoupe
          file: ./abis/DiamondLoupe.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: TokenCreated(indexed address,indexed address,string,string,address[],bytes32)
          handler: handleTokenCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
        - event: DiscountSet(indexed address,uint256)
          handler: handleDiscountSet
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/token-factory.ts

  # AcquisitionFactory - tracks acquisition/listing creation (Permissionless)
  - kind: ethereum/contract
    name: AcquisitionFactory
    network: base-sepolia
    source:
      address: "0x39F1Ef9a5cFc3e47FccDbfd501DA6E9F5f61C5D0"
      abi: AcquisitionFactory
      startBlock: 35119881 # Reverted to capture wallets created Dec 17-24
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Acquisition
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
        - UserRole
      abis:
        - name: AcquisitionFactory
          file: ./abis/AcquisitionFactory.json
        - name: AcquisitionFactoryCoreFacet
          file: ./abis/AcquisitionFactoryCoreFacet.json
        - name: FactoryPaymentFacet
          file: ./abis/FactoryPaymentFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: AcquisitionCreated(indexed address,indexed address,uint256)
          handler: handleAcquisitionCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/acquisition-factory.ts

  # USDC - tracks USDC transfers to/from CapSign wallets
  - kind: ethereum/contract
    name: USDC
    network: base-sepolia
    source:
      address: "0x036CbD53842c5426634e7929541eC2318f3dCF7e"
      abi: ERC20
      startBlock: 35119881
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - AssetTransfer
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleUSDCTransfer
          receipt: false
      file: ./src/mappings/native-transfers.ts

  # CapSignPaymaster - tracks gas sponsorship
  - kind: ethereum/contract
    name: CapSignPaymaster
    network: base-sepolia
    source:
      address: "0x12109F20880e1387C10F804EB8e3526D186eF728"
      abi: CapSignPaymasterFacet
      startBlock: 35120181
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - PaymasterDeposit
        - PaymasterWithdrawal
        - SponsoredTransaction
        - PolicyCheckFailure
        - PaymasterPolicy
      abis:
        - name: CapSignPaymasterFacet
          file: ./abis/CapSignPaymasterFacet.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,indexed address,uint256)
          handler: handleWithdrawn
        - event: Sponsored(indexed address,indexed address,uint256,uint256)
          handler: handleSponsored
        - event: PolicyCheckFailed(indexed address,indexed address,string)
          handler: handlePolicyCheckFailed
      file: ./src/mappings/paymaster.ts

templates:
  # Offering Diamond Template
  - kind: ethereum/contract
    name: OfferingDiamond
    network: base-sepolia
    source:
      abi: OfferingDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Investment
        - OffchainInvestment
        - DocumentSignature
        - OfferingTemplate
        - OfferingDocument
        - OfferingDocumentSignature
        - KYCStatus
        - InvestorClassification
        - Wallet
        - SafePreApprovedTerms
        - AuthorityDelegation
      abis:
        - name: OfferingDiamond
          file: ./abis/OfferingDiamond.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: OfferingDocuments
          file: ./abis/OfferingDocumentsFacet.json
        - name: OfferingCompliance
          file: ./abis/OfferingComplianceFacet.json
        - name: OfferingOffchain
          file: ./abis/OfferingOffchainFacet.json
        - name: OfferingTerms
          file: ./abis/OfferingTermsFacet.json
        - name: ComplianceAdmin
          file: ./abis/ComplianceAdminFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: AuthorityUpdated(indexed address,indexed address)
          handler: handleOfferingAuthorityUpdated
        - event: OfferingInitialized(indexed address,indexed address,address,address,uint256,uint256,uint256,uint256,string)
          handler: handleOfferingInitialized
        - event: FundsDeposited(indexed address,indexed uint256,uint256,uint256,bytes32,bytes32)
          handler: handleFundsDeposited
        - event: InvestmentAccepted(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentAccepted
        - event: InvestmentRejected(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentRejected
        - event: DocumentSignerRoleUpdated(uint8)
          handler: handleDocumentSignerRoleUpdated
        - event: OfferingStatusChanged(uint8,uint8)
          handler: handleOfferingStatusChanged
        - event: OfferingURIUpdated(string,string)
          handler: handleOfferingURIUpdated
        - event: PaymentRecipientUpdated(indexed address,indexed address)
          handler: handlePaymentRecipientUpdated
        - event: PricePerTokenUpdated(uint256,uint256)
          handler: handlePricePerTokenUpdated
        - event: DeadlineExtended(uint256,uint256)
          handler: handleDeadlineExtended
        - event: MinMaxInvestmentUpdated(uint256,uint256,uint256,uint256)
          handler: handleMinMaxInvestmentUpdated
        - event: DocumentEligibilityModeSet(uint8)
          handler: handleDocumentEligibilityModeSet
        - event: TemplateRegistered(indexed bytes32,indexed bytes32,string,indexed address)
          handler: handleTemplateRegistered
          receipt: true
        - event: RequiredDocumentSet(indexed bytes32,uint8)
          handler: handleRequiredDocumentSet
        - event: DocumentCreated(indexed bytes32,indexed bytes32,indexed address,string)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleOfferingDocumentSigned
        - event: DocumentRequirementAdded(indexed uint256,string,uint8,uint8)
          handler: handleDocumentRequirementAdded
        - event: DocumentRequirementUpdated(indexed uint256,string,uint8,uint8,uint8)
          handler: handleDocumentRequirementUpdated
        - event: DocumentRequirementRemoved(indexed uint256)
          handler: handleDocumentRequirementRemoved
          receipt: true
        - event: ComplianceInitialized(bool,bool)
          handler: handleComplianceInitialized
        - event: AllowsGeneralSolicitationUpdated(bool)
          handler: handleAllowsGeneralSolicitationUpdated
        - event: AllowsSelfCertificationUpdated(bool)
          handler: handleAllowsSelfCertificationUpdated
        - event: ComplianceModuleRegistered(indexed string,indexed address,uint256)
          handler: handleComplianceModuleRegistered
        - event: ComplianceModuleEnabled(indexed string,bool)
          handler: handleComplianceModuleEnabled
        - event: KYCStatusUpdated(indexed address,bool,uint64,indexed address)
          handler: handleKYCStatusUpdated
        - event: KYCRevoked(indexed address,indexed address)
          handler: handleKYCRevoked
        - event: ClassificationUpdated(indexed address,bytes32[],uint64,indexed address)
          handler: handleClassificationUpdated
        - event: ClassificationRevoked(indexed address,indexed address)
          handler: handleClassificationRevoked
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleOfferingUserRoleUpdated
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleOfferingFunctionAccessChanged
        - event: CustomTermsSet(indexed uint256,indexed address,bytes)
          handler: handleCustomTermsSet
        - event: OffchainInvestmentRecorded(indexed uint256,indexed address,uint256,uint256,string)
          handler: handleOffchainInvestmentRecorded
          receipt: false
        - event: OffchainInvestmentConfirmed(indexed uint256,indexed address)
          handler: handleOffchainInvestmentConfirmed
          receipt: false
        - event: OffchainInvestmentCancelled(indexed uint256,indexed address)
          handler: handleOffchainInvestmentCancelled
          receipt: false
      file: ./src/mappings/offerings.ts
  
  # Token Diamond Template
  - kind: ethereum/contract
    name: TokenDiamond
    network: base-sepolia
    source:
      abi: TokenDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ShareClass
        - Lot
        - Token
        - TokenClaim
        - AuthorityDelegation
      abis:
        - name: TokenDiamond
          file: ./abis/TokenDiamond.json
        - name: TokenBalances
          file: ./abis/TokenBalancesFacet.json
        - name: TokenLots
          file: ./abis/TokenLotsFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: TokenCompliance
          file: ./abis/TokenComplianceFacet.json
        - name: TokenClaims
          file: ./abis/TokenClaimsFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: AuthorityUpdated(indexed address,indexed address)
          handler: handleTokenAuthorityUpdated
        - event: LotCreated(indexed bytes32,indexed uint256,indexed address,uint256)
          handler: handleLotCreated
        - event: LotTransferred(indexed bytes32,indexed address,indexed address,uint256,string,bytes,uint8,uint256)
          handler: handleLotTransferred
        - event: LotAdjusted(indexed bytes32,indexed bytes32,indexed address,uint256,uint256,address,uint256,string)
          handler: handleLotAdjusted
        - event: LotURIUpdated(indexed bytes32,string,string)
          handler: handleLotURIUpdated
        - event: LotInvalidated(indexed bytes32)
          handler: handleLotInvalidated
        - event: Paused(indexed address)
          handler: handlePaused
        - event: Unpaused(indexed address)
          handler: handleUnpaused
        - event: AccountFrozen(indexed address)
          handler: handleAccountFrozen
        - event: AccountUnfrozen(indexed address)
          handler: handleAccountUnfrozen
        - event: LotFrozen(indexed bytes32)
          handler: handleLotFrozen
        - event: LotUnfrozen(indexed bytes32)
          handler: handleLotUnfrozen
        - event: TokenRetired(uint256)
          handler: handleTokenRetired
        - event: TokenUnretired(uint256)
          handler: handleTokenUnretired
        - event: DefaultTermsSet(uint256,uint256,address,bool,bool)
          handler: handleDefaultTermsSet
        - event: LotTermsSet(indexed bytes32,uint256,uint256,address,bool)
          handler: handleLotTermsSet
        - event: SAFEConverted(indexed bytes32,indexed address,indexed bytes32,uint256,uint256,uint256,address,string)
          handler: handleSAFEConverted
        - event: MaxSupplyUpdated(uint256)
          handler: handleMaxSupplyUpdated
        - event: BaseURIUpdated(string)
          handler: handleBaseURIUpdated
        - event: StockSplitApplied(uint256,uint256)
          handler: handleStockSplitApplied
        - event: StockDividendApplied(uint256,uint256,bool)
          handler: handleStockDividendApplied
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleTokenUserRoleUpdated
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleTokenFunctionAccessChanged
        - event: LotModuleAdded(indexed bytes32,indexed address)
          handler: handleLotModuleAdded
        - event: ClaimCreated(indexed bytes32,indexed bytes32,uint256,indexed address)
          handler: handleClaimCreated
          receipt: false
        - event: ClaimRedeemed(indexed bytes32,indexed address,indexed bytes32)
          handler: handleClaimRedeemed
          receipt: false
        - event: ClaimCancelled(indexed bytes32,indexed address)
          handler: handleClaimCancelled
        - event: ComplianceModuleAdded(indexed address,string)
          handler: handleComplianceModuleAdded
        - event: ComplianceModuleRemoved(indexed address,string)
          handler: handleComplianceModuleRemoved
        - event: LotModuleAdded(indexed bytes32,indexed address)
          handler: handleLotModuleAdded
        - event: DebtTermsSet(uint256,uint256,uint256,uint256,address,uint8,bool)
          handler: handleDebtTermsSet
      file: ./src/mappings/tokens.ts
  
  # Wallet Diamond Template
  - kind: ethereum/contract
    name: WalletDiamond
    network: base-sepolia
    source:
      abi: WalletDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Diamond
        - FunctionAccess
        - UserRole
        - Document
        - DocumentSignature
        - Attestation
        - Vehicle
        - VehicleMember
        - CapitalContribution
        - Distribution
        - DistributionClaim
        - VehicleInvestment
        - AuthorityDelegation
        - TargetFunctionPermission
      abis:
        - name: WalletDiamond
          file: ./abis/WalletDiamond.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
        - name: WalletDocuments
          file: ./abis/WalletDocumentsFacet.json
        - name: VehicleMembers
          file: ./abis/VehicleMembersFacet.json
        - name: SPVDistribution
          file: ./abis/SPVDistributionFacet.json
        - name: WalletPaymasterPolicyFacet
          file: ./abis/WalletPaymasterPolicyFacet.json
        - name: WalletAccessManager
          file: ./abis/WalletAccessManagerFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
          receipt: false
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleWalletFunctionAccessChanged
          receipt: false
        - event: WalletTargetFunctionRoleSet(indexed address,indexed bytes4,uint8)
          handler: handleWalletTargetFunctionRoleSet
        - event: WalletInitialized(indexed address,string)
          handler: handleWalletInitialized
        - event: DocumentUploaded(indexed bytes32,indexed bytes32,indexed address)
          handler: handleDocumentUploaded
          receipt: true
        - event: DocumentCreated(indexed bytes32,indexed address,string,address[],string)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleDocumentSigned
          receipt: true
        - event: AttestationAdded(indexed bytes32,indexed string,uint256)
          handler: handleAttestationAdded
        - event: AttestationRevoked(indexed bytes32,uint256)
          handler: handleAttestationRevoked
        # Vehicle events (from VehicleMembers ABI)
        - event: CapitalContributed(indexed address,uint256,uint256)
          handler: handleCapitalContributed
          receipt: false
        - event: DistributionExecuted(indexed uint256,uint256,uint256)
          handler: handleDistributionExecuted
          receipt: false
        - event: DistributionClaimed(indexed uint256,indexed address,uint256,uint256)
          handler: handleDistributionClaimed
          receipt: false
        - event: MemberAdded(indexed address,uint256)
          handler: handleMemberAdded
          receipt: false
        - event: MemberRemoved(indexed address)
          handler: handleMemberRemoved
          receipt: false
        - event: InvestmentMade(indexed uint256,indexed address,uint8,uint256,uint256)
          handler: handleInvestmentMade
          receipt: false
        - event: ValuationUpdated(indexed uint256,uint256,uint256,uint256)
          handler: handleValuationUpdated
          receipt: false
        - event: InvestmentExited(indexed uint256,uint256,uint256)
          handler: handleInvestmentExited
          receipt: false
        # Paymaster policy events (from WalletPaymasterPolicyFacet ABI)
        - event: PaymasterEnabled(bool)
          handler: handlePaymasterEnabled
          receipt: false
        - event: DailyBudgetSet(uint256)
          handler: handleDailyBudgetSet
          receipt: false
        - event: PaymasterAddressSet(indexed address)
          handler: handlePaymasterAddressSet
          receipt: false
        - event: RolePolicySet(indexed uint8,bool,uint256)
          handler: handleRolePolicySet
          receipt: false
        - event: SpendingRecorded(indexed address,uint256)
          handler: handleSpendingRecorded
          receipt: false
        # Native asset transfer tracking
        - event: TransactionExecuted(indexed address,uint256,bytes)
          handler: handleTransactionExecuted
          receipt: false
        - event: EtherReceived(indexed address,uint256)
          handler: handleEtherReceived
          receipt: false
      file: ./src/mappings/wallets.ts

  # Acquisition Diamond Template
  - kind: ethereum/contract
    name: AcquisitionDiamond
    network: base-sepolia
    source:
      abi: AcquisitionCoreFacet
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Acquisition
      abis:
        - name: AcquisitionDiamond
          file: ./abis/AcquisitionDiamond.json
        - name: AcquisitionCoreFacet
          file: ./abis/AcquisitionCoreFacet.json
      eventHandlers:
        - event: AcquisitionListed(uint256)
          handler: handleAcquisitionListed
        - event: AcquisitionCancelled()
          handler: handleAcquisitionCancelled
        - event: OfferAccepted(indexed address)
          handler: handleOfferAccepted
        - event: DisputeRaised(indexed address)
          handler: handleDisputeRaised
      file: ./src/mappings/acquisitions.ts

  # NOTE: Rule144ComplianceModule template removed - replaced by modular HoldingPeriodModule, VolumeLimitModule, AffiliateStatusModule

  # Holding Period Module Template
  - kind: ethereum/contract
    name: HoldingPeriodModule
    network: base-sepolia
    source:
      abi: HoldingPeriodModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - HoldingPeriodConfig
        - Token
      abis:
        - name: HoldingPeriodModule
          file: ./abis/HoldingPeriodModule.json
      eventHandlers:
        - event: HoldingPeriodSet(indexed address,uint256)
          handler: handleHoldingPeriodSet
        - event: AcquisitionDateSet(indexed address,indexed bytes32,indexed address,uint256)
          handler: handleAcquisitionDateSet
        - event: AcquisitionDateUpdated(indexed address,indexed bytes32,indexed address,uint256)
          handler: handleAcquisitionDateUpdated
      file: ./src/mappings/holding-period-module.ts

  # Volume Limit Module Template
  - kind: ethereum/contract
    name: VolumeLimitModule
    network: base-sepolia
    source:
      abi: VolumeLimitModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - VolumeLimitConfig
        - Token
      abis:
        - name: VolumeLimitModule
          file: ./abis/VolumeLimitModule.json
      eventHandlers:
        - event: VolumeConfigSet(indexed address,uint256,uint256,bool)
          handler: handleVolumeConfigSet
        - event: VolumeRecorded(indexed address,indexed address,uint256,uint256)
          handler: handleVolumeRecorded
        - event: WindowReset(indexed address,indexed address,uint256)
          handler: handleWindowReset
      file: ./src/mappings/volume-limit-module.ts

  # Affiliate Status Module Template
  - kind: ethereum/contract
    name: AffiliateStatusModule
    network: base-sepolia
    source:
      abi: AffiliateStatusModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - AffiliateStatus
        - AffiliateStatusChange
        - Token
      abis:
        - name: AffiliateStatusModule
          file: ./abis/AffiliateStatusModule.json
      eventHandlers:
        - event: AffiliateStatusSet(indexed address,indexed address,bool)
          handler: handleAffiliateStatusSet
        - event: AffiliateStatusBatchSet(indexed address,uint256)
          handler: handleAffiliateStatusBatchSet
      file: ./src/mappings/affiliate-status-module.ts

  # Lockup Compliance Module Template (Lot-level)
  - kind: ethereum/contract
    name: LockupComplianceModule
    network: base-sepolia
    source:
      abi: LockupComplianceModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - LockupConfig
      abis:
        - name: LockupComplianceModule
          file: ./abis/LockupComplianceModule.json
      eventHandlers:
        - event: LockupSet(indexed bytes32,uint256)
          handler: handleLockupSet
        - event: LockupExtended(indexed bytes32,uint256,uint256)
          handler: handleLockupExtended
        - event: LockupRemoved(indexed bytes32)
          handler: handleLockupRemoved
      file: ./src/mappings/lockup-module.ts

  # Vesting Compliance Module Template (Lot-level)
  - kind: ethereum/contract
    name: VestingComplianceModule
    network: base-sepolia
    source:
      abi: VestingComplianceModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - VestingConfig
      abis:
        - name: VestingComplianceModule
          file: ./abis/VestingComplianceModule.json
      eventHandlers:
        - event: VestingScheduleCreated(indexed address,indexed bytes32,uint256,uint256,uint256,uint256,bool)
          handler: handleVestingScheduleCreated
        - event: TokensReleased(indexed address,indexed bytes32,uint256)
          handler: handleTokensReleased
        - event: VestingScheduleRevoked(indexed address,indexed bytes32)
          handler: handleVestingScheduleRevoked
      file: ./src/mappings/vesting-module.ts

