specVersion: 1.0.0
schema:
  file: ./schema.graphql
dataSources:
  # Diamond Factory - tracks all diamond creation
  - kind: ethereum/contract
    name: DiamondFactory
    network: base-sepolia
    source:
      address: "0x4B0b3572ac00ca5935717A6a9E4c56Ab5FA44C56"
      abi: FactoryCoreFacet
      startBlock: 34605588
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Diamond
        - Wallet
        - Offering
        - ShareClass
      abis:
        - name: FactoryCoreFacet
          file: ./abis/FactoryCoreFacet.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
      eventHandlers:
        - event: DiamondCreated(indexed address,indexed address,indexed bytes32)
          handler: handleDiamondCreated
      file: ./src/mappings/diamond-factory.ts
  
  # EAS - tracks attestations
  - kind: ethereum/contract
    name: EAS
    network: base-sepolia
    source:
      address: "0x4200000000000000000000000000000000000021"
      abi: EAS
      startBlock: 31965997
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Attestation
        - Wallet
      abis:
        - name: EAS
          file: ./abis/EAS.json
      eventHandlers:
        - event: Attested(indexed address,indexed address,bytes32,indexed bytes32)
          handler: handleAttested
        - event: Revoked(indexed address,indexed address,bytes32,indexed bytes32)
          handler: handleRevoked
      file: ./src/mappings/attestations.ts

  # FacetRegistry - tracks facet registration and deployment
  - kind: ethereum/contract
    name: FacetRegistry
    network: base-sepolia
    source:
      address: "0x495394087eAd4a60A98145c2aBb752649469e475"
      abi: RegistryCoreFacet
      startBlock: 33210200
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Facet
        - FacetRegistryEvent
      abis:
        - name: RegistryCoreFacet
          file: ./abis/RegistryCoreFacet.json
      eventHandlers:
        - event: FacetRegistered(indexed string,indexed string,address,uint256)
          handler: handleFacetRegistered
        - event: FacetRemoved(indexed string,indexed string)
          handler: handleFacetRemoved
      file: ./src/mappings/facet-registry.ts

  # WalletFactory - tracks wallet creation with owner types (Permissionless)
  - kind: ethereum/contract
    name: WalletFactory
    network: base-sepolia
    source:
      address: "0x628Fc9fDF34132F41e41ea98a6Cd68DD504f38Bc"
      abi: WalletFactoryCoreFacet
      startBlock: 33215855
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Diamond
      abis:
        - name: WalletFactoryCoreFacet
          file: ./abis/WalletFactoryCoreFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
      eventHandlers:
        - event: WalletCreated(indexed address,indexed address,uint8,indexed bytes32,address)
          handler: handleWalletCreated
      file: ./src/mappings/wallet-factory.ts

  # OfferingFactory - tracks offering creation (Permissionless)
  - kind: ethereum/contract
    name: OfferingFactory
    network: base-sepolia
    source:
      address: "0xE9F2A24a9eBEC7575BC12Ac7F9A96271753FD1Ed"
      abi: OfferingFactory
      startBlock: 34605588
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
      abis:
        - name: OfferingFactory
          file: ./abis/OfferingFactory.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
      eventHandlers:
        - event: OfferingCreated(indexed address,indexed address,indexed address,address)
          handler: handleOfferingCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
      file: ./src/mappings/offering-factory.ts

  # TokenFactory - tracks token creation (Permissionless)
  - kind: ethereum/contract
    name: TokenFactory
    network: base-sepolia
    source:
      address: "0x99efD736b6ce871825aaef7BB25B683C4b68924C"
      abi: TokenFactory
      startBlock: 33434900
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ShareClass
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
      abis:
        - name: TokenFactory
          file: ./abis/TokenFactory.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
      eventHandlers:
        - event: TokenCreated(indexed address,indexed address,string,string,address[],bytes32)
          handler: handleTokenCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
      file: ./src/mappings/token-factory.ts

templates:
  # Offering Diamond Template
  - kind: ethereum/contract
    name: OfferingDiamond
    network: base-sepolia
    source:
      abi: OfferingDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Investment
        - DocumentSignature
        - OfferingTemplate
        - OfferingDocument
        - OfferingDocumentSignature
      abis:
        - name: OfferingDiamond
          file: ./abis/OfferingDiamond.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: OfferingDocuments
          file: ./abis/OfferingDocumentsFacet.json
        - name: OfferingCompliance
          file: ./abis/OfferingComplianceFacet.json
        - name: OfferingOffchain
          file: ./abis/OfferingOffchainFacet.json
        - name: ComplianceAdmin
          file: ./abis/ComplianceAdminFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: OfferingInitialized(indexed address,indexed address,address,address,uint256,uint256,uint256,uint256,string)
          handler: handleOfferingInitialized
        - event: FundsDeposited(indexed address,indexed uint256,uint256,uint256,bytes32,bytes32)
          handler: handleFundsDeposited
        - event: InvestmentAccepted(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentAccepted
        - event: InvestmentRejected(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentRejected
        - event: OfferingStatusChanged(uint8,uint8)
          handler: handleOfferingStatusChanged
        - event: TemplateRegistered(indexed bytes32,indexed bytes32,string,indexed address)
          handler: handleTemplateRegistered
          receipt: true
        - event: RequiredDocumentSet(indexed bytes32,uint8)
          handler: handleRequiredDocumentSet
        - event: DocumentCreated(indexed bytes32,indexed bytes32,indexed bytes32,address)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleOfferingDocumentSigned
          receipt: true
        - event: DocumentEligibilityModeSet(indexed uint8)
          handler: handleDocumentEligibilityModeSet
        - event: CustomEligibilityModuleSet(indexed address)
          handler: handleCustomEligibilityModuleSet
        - event: ComplianceInitialized(bool,bool)
          handler: handleComplianceInitialized
        - event: AllowsGeneralSolicitationUpdated(bool)
          handler: handleAllowsGeneralSolicitationUpdated
        - event: AllowsSelfCertificationUpdated(bool)
          handler: handleAllowsSelfCertificationUpdated
        - event: ComplianceModuleRegistered(indexed string,indexed address,uint256)
          handler: handleComplianceModuleRegistered
        - event: ComplianceModuleEnabled(indexed string,bool)
          handler: handleComplianceModuleEnabled
        - event: OffchainInvestmentRecorded(indexed uint256,indexed address,uint256,uint256,string)
          handler: handleOffchainInvestmentRecorded
        - event: OffchainInvestmentConfirmed(indexed uint256,indexed address)
          handler: handleOffchainInvestmentConfirmed
        - event: OffchainInvestmentCancelled(indexed uint256,indexed address)
          handler: handleOffchainInvestmentCancelled
        - event: KYCStatusUpdated(indexed address,bool,uint256,indexed address)
          handler: handleKYCStatusUpdated
        - event: KYCRevoked(indexed address,indexed address)
          handler: handleKYCRevoked
        - event: ClassificationUpdated(indexed address,bytes32[],indexed address)
          handler: handleClassificationUpdated
        - event: ClassificationRevoked(indexed address,indexed address)
          handler: handleClassificationRevoked
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleOfferingUserRoleUpdated
      file: ./src/mappings/offerings.ts
  
  # Token Diamond Template
  - kind: ethereum/contract
    name: TokenDiamond
    network: base-sepolia
    source:
      abi: TokenDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ShareClass
        - Lot
        - Token
      abis:
        - name: TokenDiamond
          file: ./abis/TokenDiamond.json
        - name: TokenBalances
          file: ./abis/TokenBalancesFacet.json
        - name: TokenLots
          file: ./abis/TokenLotsFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: TokenCompliance
          file: ./abis/TokenComplianceFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: LotCreated(indexed bytes32,indexed uint256,indexed address,uint256)
          handler: handleLotCreated
        - event: LotTransferred(indexed bytes32,indexed address,indexed address,uint256,string,bytes,uint8,uint256)
          handler: handleLotTransferred
        - event: LotInvalidated(indexed bytes32)
          handler: handleLotInvalidated
        - event: Paused(indexed address)
          handler: handlePaused
        - event: Unpaused(indexed address)
          handler: handleUnpaused
        - event: AccountFrozen(indexed address)
          handler: handleAccountFrozen
        - event: AccountUnfrozen(indexed address)
          handler: handleAccountUnfrozen
        - event: LotFrozen(indexed bytes32)
          handler: handleLotFrozen
        - event: LotUnfrozen(indexed bytes32)
          handler: handleLotUnfrozen
        - event: MaxSupplyUpdated(uint256)
          handler: handleMaxSupplyUpdated
        - event: BaseURIUpdated(string)
          handler: handleBaseURIUpdated
        - event: StockSplitApplied(uint256,uint256)
          handler: handleStockSplitApplied
        - event: StockDividendApplied(uint256,uint256,bool)
          handler: handleStockDividendApplied
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleTokenUserRoleUpdated
        - event: LotModuleAdded(indexed bytes32,indexed address)
          handler: handleLotModuleAdded
      file: ./src/mappings/tokens.ts
  
  # Wallet Diamond Template
  - kind: ethereum/contract
    name: WalletDiamond
    network: base-sepolia
    source:
      abi: WalletDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Document
        - DocumentSignature
        - Attestation
      abis:
        - name: WalletDiamond
          file: ./abis/WalletDiamond.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
        - name: WalletDocuments
          file: ./abis/WalletDocumentsFacet.json
      eventHandlers:
        - event: WalletInitialized(indexed address,string)
          handler: handleWalletInitialized
        - event: DocumentUploaded(indexed bytes32,indexed bytes32,indexed address)
          handler: handleDocumentUploaded
          receipt: true
        - event: DocumentCreated(indexed bytes32,indexed address,string,address[],string)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleDocumentSigned
          receipt: true
        - event: AttestationAdded(indexed bytes32,indexed string,uint256)
          handler: handleAttestationAdded
        - event: AttestationRevoked(indexed bytes32,uint256)
          handler: handleAttestationRevoked
      file: ./src/mappings/wallets.ts

