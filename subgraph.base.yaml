specVersion: 1.0.0
schema:
  file: ./schema.graphql
dataSources:
  # Diamond Factory - tracks all diamond creation
  - kind: ethereum/contract
    name: DiamondFactory
    network: base
    source:
      address: "0x7d649b6B7613dC300e65007CC9d30a99D01768eF"
      abi: DiamondFactory
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Diamond
        - Wallet
        - Offering
        - EquityToken
        - UserRole
      abis:
        - name: DiamondFactory
          file: ./abis/DiamondFactory.json
        - name: FactoryCoreFacet
          file: ./abis/FactoryCoreFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
      eventHandlers:
        - event: DiamondCreated(indexed address,indexed address,indexed bytes32)
          handler: handleDiamondCreated
        - event: FacetRegistryUpdated(indexed address)
          handler: handleFacetRegistryUpdated
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
          receipt: false
      file: ./src/mappings/diamond-factory.ts
  
  # EAS - tracks attestations (DEPRECATED - kept for backward compatibility)
  # New compliance data is tracked via ComplianceAdminFacet events in offering diamonds
  # - kind: ethereum/contract
  #   name: EAS
  #   network: base
  #   source:
  #     address: "0x4200000000000000000000000000000000000021"
  #     abi: EAS
  #     startBlock: 39712238
  #   mapping:
  #     kind: ethereum/events
  #     apiVersion: 0.0.7
  #     language: wasm/assemblyscript
  #     entities:
  #       - Attestation
  #       - Wallet
  #     abis:
  #       - name: EAS
  #         file: ./abis/EAS.json
  #     eventHandlers:
  #       - event: Attested(indexed address,indexed address,bytes32,indexed bytes32)
  #         handler: handleAttested
  #       - event: Revoked(indexed address,indexed address,bytes32,indexed bytes32)
  #         handler: handleRevoked
  #     file: ./src/mappings/attestations.ts

  # FacetRegistry - tracks facet registration and deployment
  # IMPORTANT: Must start from original deployment to capture all facet registrations
  - kind: ethereum/contract
    name: FacetRegistry
    network: base
    source:
      address: "0x01cdbAcb482Ee98c74e9e70Dbc485cFCAE794849"
      abi: FacetRegistry
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Facet
        - FacetRegistryEvent
      abis:
        - name: FacetRegistry
          file: ./abis/FacetRegistry.json
      eventHandlers:
        - event: FacetRegistered(string,indexed uint256,indexed address)
          handler: handleFacetRegistered
        - event: FacetRemoved(string,indexed uint256)
          handler: handleFacetRemoved
      file: ./src/mappings/facet-registry.ts

  # WalletFactory - tracks wallet creation with owner types (Permissionless)
  - kind: ethereum/contract
    name: WalletFactory
    network: base
    source:
      address: "0xd638662A6C58bfD53741bdE183cd75F8eD975159"
      abi: WalletFactory
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Diamond
        - UserRole
      abis:
        - name: WalletFactory
          file: ./abis/WalletFactory.json
        - name: WalletFactoryCoreFacet
          file: ./abis/WalletFactoryCoreFacet.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: WalletCreated(indexed address,indexed address,uint8,indexed bytes32,address)
          handler: handleWalletCreated
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/wallet-factory.ts

  # OfferingFactory - tracks offering creation (Permissionless)
  - kind: ethereum/contract
    name: OfferingFactory
    network: base
    source:
      address: "0xBE488e39dB5157ae7BBc60fE359ABC4157FBadb7"
      abi: OfferingFactory
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
        - UserRole
      abis:
        - name: OfferingFactory
          file: ./abis/OfferingFactory.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        - event: OfferingCreated(indexed address,indexed address,indexed address,address[])
          handler: handleOfferingCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
        - event: DiscountSet(indexed address,uint256)
          handler: handleDiscountSet
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/offering-factory.ts

  # TokenFactory - tracks token creation (Permissionless)
  - kind: ethereum/contract
    name: TokenFactory
    network: base
    source:
      address: "0xB9a72e2c95f2088F65c72a7eB6c8FE88FAD64339"
      abi: TokenFactory
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - EquityToken
        - Safe
        - Diamond
        - FactoryPaymentConfig
        - FactoryPaymentToken
        - FactoryPayment
        - UserRole
      abis:
        - name: TokenFactory
          file: ./abis/TokenFactory.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: DiamondInspect
          file: ./abis/DiamondInspectFacet.json
        - name: TokenTypeFacet
          file: ./abis/TokenTypeFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
        - name: TokenSAFEFacet
          file: ./abis/TokenSAFEFacet.json
      eventHandlers:
        - event: TokenCreated(indexed address,indexed address,string,string,address[],bytes32)
          handler: handleTokenCreated
        - event: PaymentModuleInitialized(indexed address)
          handler: handlePaymentModuleInitialized
        - event: PaymentTokenConfigured(indexed address,uint256,bool)
          handler: handlePaymentTokenConfigured
        - event: PaymentCollected(indexed address,indexed address,uint256,string)
          handler: handlePaymentCollected
        - event: FeeRecipientUpdated(indexed address)
          handler: handleFeeRecipientUpdated
        - event: PaymentsStatusChanged(bool)
          handler: handlePaymentsStatusChanged
        - event: DiscountSet(indexed address,uint256)
          handler: handleDiscountSet
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
      file: ./src/mappings/token-factory.ts

  # EscrowFactory - tracks escrow creation (Permissionless)
  # TODO: Add EscrowFactory ABI and mappings
  # - kind: ethereum/contract
  #   name: EscrowFactory
  #   network: base
  #   source:
  #     address: "0xa37E52Ddf9e3fD7e4806C8d442405ff5616E0E4A"
  #     abi: EscrowFactory
  #     startBlock: 40489103 # Updated 2026-01-07 - Fresh deployment with new storage slots
  #   mapping:
  #     kind: ethereum/events
  #     apiVersion: 0.0.7
  #     language: wasm/assemblyscript
  #     entities:
  #       - Escrow
  #     abis:
  #       - name: EscrowFactory
  #         file: ./abis/EscrowFactory.json
  #     eventHandlers:
  #       - event: EscrowCreated(indexed address,indexed address)
  #         handler: handleEscrowCreated
  #     file: ./src/mappings/escrow-factory.ts

  # USDC - tracks USDC transfers to/from CapSign wallets
  - kind: ethereum/contract
    name: USDC
    network: base
    source:
      address: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"
      abi: ERC20
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Activity
        - AssetTransfer
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleUSDCTransfer
          receipt: false
      file: ./src/mappings/native-transfers.ts

  # CapSignPaymaster - tracks gas sponsorship
  - kind: ethereum/contract
    name: CapSignPaymaster
    network: base
    source:
      address: "0x839386C819B610BcDeC1546299fAe3E649af5e41"
      abi: CapSignPaymasterFacet
      startBlock: 42114000 # Demo reset - clean slate
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - PaymasterDeposit
        - PaymasterWithdrawal
        - SponsoredTransaction
        - PolicyCheckFailure
        - PaymasterPolicy
      abis:
        - name: CapSignPaymasterFacet
          file: ./abis/CapSignPaymasterFacet.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,indexed address,uint256)
          handler: handleWithdrawn
        - event: Sponsored(indexed address,indexed address,uint256,uint256)
          handler: handleSponsored
        - event: PolicyCheckFailed(indexed address,indexed address,string)
          handler: handlePolicyCheckFailed
      file: ./src/mappings/paymaster.ts

templates:
  # Offering Diamond Template
  - kind: ethereum/contract
    name: OfferingDiamond
    network: base
    source:
      abi: OfferingDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Offering
        - Investment
        - OffchainInvestment
        - DocumentSignature
        - OfferingTemplate
        - OfferingDocument
        - OfferingDocumentSignature
        - KYCStatus
        - InvestorClassification
        - Wallet
        - SafePreApprovedTerms
        - AuthorityDelegation
        - InstalledFacet
        - DiamondCutEvent
      abis:
        - name: OfferingDiamond
          file: ./abis/OfferingDiamond.json
        - name: OfferingCore
          file: ./abis/OfferingCoreFacet.json
        - name: OfferingDocuments
          file: ./abis/OfferingDocumentsFacet.json
        - name: OfferingCompliance
          file: ./abis/OfferingComplianceFacet.json
        - name: OfferingOffchain
          file: ./abis/OfferingOffchainFacet.json
        - name: OfferingTerms
          file: ./abis/OfferingTermsFacet.json
        - name: ComplianceAdmin
          file: ./abis/ComplianceAdminFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
      eventHandlers:
        # Diamond upgrade tracking (ERC-8109 declarative upgrades)
        - event: DiamondFunctionAdded(indexed bytes4,indexed address)
          handler: handleDiamondFunctionAdded
          receipt: false
        - event: DiamondFunctionReplaced(indexed bytes4,indexed address)
          handler: handleDiamondFunctionReplaced
          receipt: false
        - event: DiamondFunctionRemoved(indexed bytes4)
          handler: handleDiamondFunctionRemoved
          receipt: false
        - event: AuthorityUpdated(indexed address,indexed address)
          handler: handleOfferingAuthorityUpdated
        - event: OfferingInitialized(indexed address,indexed address,address,address,uint256,uint256,uint256,uint256,string)
          handler: handleOfferingInitialized
        - event: FundsDeposited(indexed address,indexed uint256,uint256,uint256,bytes32,bytes32)
          handler: handleFundsDeposited
        - event: InvestmentAccepted(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentAccepted
        - event: InvestmentRejected(indexed uint256,indexed address,indexed address)
          handler: handleInvestmentRejected
        # Commitment-based offering events
        - event: CommitmentMade(indexed address,indexed uint256,uint256,uint256,bytes32)
          handler: handleCommitmentMade
          receipt: false
        - event: DocumentSignerRoleUpdated(uint8)
          handler: handleDocumentSignerRoleUpdated
        - event: OfferingStatusChanged(uint8,uint8)
          handler: handleOfferingStatusChanged
        - event: OfferingURIUpdated(string,string)
          handler: handleOfferingURIUpdated
        - event: PaymentRecipientUpdated(indexed address,indexed address)
          handler: handlePaymentRecipientUpdated
        - event: PricePerTokenUpdated(uint256,uint256)
          handler: handlePricePerTokenUpdated
        - event: DeadlineExtended(uint256,uint256)
          handler: handleDeadlineExtended
        - event: MinMaxInvestmentUpdated(uint256,uint256,uint256,uint256)
          handler: handleMinMaxInvestmentUpdated
        - event: DocumentEligibilityModeSet(uint8)
          handler: handleDocumentEligibilityModeSet
        # TemplateRegistered and RequiredDocumentSet removed (events no longer exist in protocol)
        - event: DocumentCreated(indexed bytes32,indexed bytes32,indexed address,string)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleOfferingDocumentSigned
        - event: DocumentRequirementAdded(indexed uint256,string,uint8,uint8)
          handler: handleDocumentRequirementAdded
        - event: DocumentRequirementUpdated(indexed uint256,string,uint8,uint8,uint8)
          handler: handleDocumentRequirementUpdated
        - event: DocumentRequirementRemoved(indexed uint256)
          handler: handleDocumentRequirementRemoved
          receipt: true
        - event: ComplianceInitialized(bool,bool)
          handler: handleComplianceInitialized
        - event: AllowsGeneralSolicitationUpdated(bool)
          handler: handleAllowsGeneralSolicitationUpdated
        - event: AllowsSelfCertificationUpdated(bool)
          handler: handleAllowsSelfCertificationUpdated
        - event: ComplianceModuleRegistered(indexed string,indexed address,uint256)
          handler: handleComplianceModuleRegistered
        - event: ComplianceModuleEnabled(indexed string,bool)
          handler: handleComplianceModuleEnabled
        - event: KYCStatusUpdated(indexed address,bool,uint64,indexed address)
          handler: handleKYCStatusUpdated
        - event: KYCRevoked(indexed address,indexed address)
          handler: handleKYCRevoked
        - event: ClassificationUpdated(indexed address,bytes32[],uint64,indexed address)
          handler: handleClassificationUpdated
        - event: ClassificationRevoked(indexed address,indexed address)
          handler: handleClassificationRevoked
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleOfferingUserRoleUpdated
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleOfferingFunctionAccessChanged
        - event: CustomTermsSet(indexed uint256,indexed address,bytes)
          handler: handleCustomTermsSet
        - event: OffchainInvestmentRecorded(indexed uint256,indexed address,uint256,uint256,string)
          handler: handleOffchainInvestmentRecorded
          receipt: false
        - event: OffchainInvestmentConfirmed(indexed uint256,indexed address)
          handler: handleOffchainInvestmentConfirmed
          receipt: false
        - event: OffchainInvestmentCancelled(indexed uint256,indexed address)
          handler: handleOffchainInvestmentCancelled
          receipt: false
      file: ./src/mappings/offerings.ts
  
  # Token Diamond Template
  - kind: ethereum/contract
    name: TokenDiamond
    network: base
    source:
      abi: TokenDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - EquityToken
        - Lot
        - Token
        - TokenClaim
        - AuthorityDelegation
        - InstalledFacet
        - DiamondCutEvent
      abis:
        - name: TokenDiamond
          file: ./abis/TokenDiamond.json
        - name: TokenBalances
          file: ./abis/TokenBalancesFacet.json
        - name: TokenLots
          file: ./abis/TokenLotsFacet.json
        - name: TokenMetadata
          file: ./abis/TokenMetadataFacet.json
        - name: TokenCompliance
          file: ./abis/TokenComplianceFacet.json
        - name: TokenClaims
          file: ./abis/TokenClaimsFacet.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
        - name: Token409AFacet
          file: ./abis/Token409AFacet.json
        - name: TokenOptionFacet
          file: ./abis/TokenOptionFacet.json
        - name: TokenNoteFacet
          file: ./abis/TokenNoteFacet.json
      eventHandlers:
        # Promissory Note events
        - event: NoteInitialized(indexed address,indexed address,uint256,uint16,uint256)
          handler: handleNoteInitialized
        # Option grant events
        - event: OptionGranted(indexed uint256,indexed bytes32,indexed address,uint8,uint256,uint256,uint256)
          handler: handleOptionGranted
        - event: OptionExercised(indexed uint256,indexed address,uint256,uint256,bytes32)
          handler: handleOptionExercised
        - event: OptionExpired(indexed uint256,indexed address,uint256)
          handler: handleOptionExpired
        - event: OptionForfeited(indexed uint256,indexed address,uint256)
          handler: handleOptionForfeited
        # 409A Valuation events
        - event: Valuation409ARecorded(indexed uint256,uint256,uint256,uint256,bytes32,indexed address)
          handler: handleValuation409ARecorded
        - event: Valuation409AInvalidated(indexed uint256,string)
          handler: handleValuation409AInvalidated
        # Diamond upgrade tracking (ERC-8109 declarative upgrades)
        - event: DiamondFunctionAdded(indexed bytes4,indexed address)
          handler: handleDiamondFunctionAdded
          receipt: false
        - event: DiamondFunctionReplaced(indexed bytes4,indexed address)
          handler: handleDiamondFunctionReplaced
          receipt: false
        - event: DiamondFunctionRemoved(indexed bytes4)
          handler: handleDiamondFunctionRemoved
          receipt: false
        - event: AuthorityUpdated(indexed address,indexed address)
          handler: handleTokenAuthorityUpdated
        - event: LotCreated(indexed bytes32,indexed uint256,indexed address,uint256)
          handler: handleLotCreated
        - event: LotTransferred(indexed bytes32,indexed address,indexed address,uint256,string,bytes,uint8,uint256)
          handler: handleLotTransferred
        - event: LotAdjusted(indexed bytes32,indexed bytes32,indexed address,uint256,uint256,address,uint256,string)
          handler: handleLotAdjusted
        - event: LotURIUpdated(indexed bytes32,string,string)
          handler: handleLotURIUpdated
        - event: LotInvalidated(indexed bytes32)
          handler: handleLotInvalidated
        - event: Paused(indexed address)
          handler: handlePaused
        - event: Unpaused(indexed address)
          handler: handleUnpaused
        - event: AccountFrozen(indexed address)
          handler: handleAccountFrozen
        - event: AccountUnfrozen(indexed address)
          handler: handleAccountUnfrozen
        - event: LotFrozen(indexed bytes32)
          handler: handleLotFrozen
        - event: LotUnfrozen(indexed bytes32)
          handler: handleLotUnfrozen
        - event: TokenRetired(uint256)
          handler: handleTokenRetired
        - event: TokenUnretired(uint256)
          handler: handleTokenUnretired
        - event: TokenTypeSet(indexed bytes6,string)
          handler: handleTokenTypeSet
        # Bilateral SAFE events
        - event: SAFEInitialized(indexed address,indexed address,uint256,uint256,uint16)
          handler: handleSAFEInitialized
        - event: SAFEActivated(indexed address,bytes32)
          handler: handleSAFEActivated
        - event: SAFEConverted(indexed address,indexed address,uint256,uint256)
          handler: handleSAFEConverted
        - event: SAFECancelled(indexed address,uint256)
          handler: handleSAFECancelled
        - event: TargetEquityTokenSet(indexed address)
          handler: handleTargetEquityTokenSet
        - event: MaxSupplyUpdated(uint256)
          handler: handleMaxSupplyUpdated
        - event: BaseURIUpdated(string)
          handler: handleBaseURIUpdated
        - event: StockSplitApplied(uint256,uint256)
          handler: handleStockSplitApplied
        - event: StockDividendApplied(uint256,uint256,bool)
          handler: handleStockDividendApplied
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleTokenUserRoleUpdated
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleTokenFunctionAccessChanged
        - event: LotModuleAdded(indexed bytes32,indexed address)
          handler: handleLotModuleAdded
        - event: ClaimCreated(indexed bytes32,indexed bytes32,uint256,indexed address)
          handler: handleClaimCreated
          receipt: false
        - event: ClaimRedeemed(indexed bytes32,indexed address,indexed bytes32)
          handler: handleClaimRedeemed
          receipt: false
        - event: ClaimCancelled(indexed bytes32,indexed address)
          handler: handleClaimCancelled
        - event: ComplianceModuleAdded(indexed address,string)
          handler: handleComplianceModuleAdded
        - event: ComplianceModuleRemoved(indexed address,string)
          handler: handleComplianceModuleRemoved
        - event: LotModuleAdded(indexed bytes32,indexed address)
          handler: handleLotModuleAdded
        # DebtTermsSet removed (event no longer exists in protocol)
      file: ./src/mappings/tokens.ts
  
  # Wallet Diamond Template
  - kind: ethereum/contract
    name: WalletDiamond
    network: base
    source:
      abi: WalletDiamond
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Wallet
        - Diamond
        - FunctionAccess
        - UserRole
        - Document
        - DocumentSignature
        - Attestation
        - Vehicle
        - CapitalContribution
        - Distribution
        - DistributionClaim
        - VehicleInvestment
        - Trust
        - TrustParticipant
        - TrustMilestone
        - TrustVestingSchedule
        - AuthorityDelegation
        - TargetFunctionPermission
        - AuthorizedSigner
        - UserOperationExecution
        - InstalledFacet
        - DiamondCutEvent
        - EntityClassification
        - AssetDisposal
        - FundTaxYearSummary
        - Lien
        - AssetSeizure
        - WalletFreezeEvent
        - DeFiVault
        - VaultPosition
        - VaultDeposit
        - VaultWithdrawal
        - VaultValuationUpdate
        - RedemptionRequest
        - RedemptionSuspension
        - SidePocket
        - GatePeriod
        - GovernanceConfig
        - ProposalType
        - Proposal
        - Vote
      abis:
        - name: WalletDiamond
          file: ./abis/WalletDiamond.json
        - name: WalletCore
          file: ./abis/WalletCoreFacet.json
        - name: WalletDocuments
          file: ./abis/WalletDocumentsFacet.json
        # New capital/investment facets (replaced Vehicle* facets)
        - name: CapitalCallFacet
          file: ./abis/CapitalCallFacet.json
        - name: CommitmentFacet
          file: ./abis/CommitmentFacet.json
        - name: FeeAccrualFacet
          file: ./abis/FeeAccrualFacet.json
        - name: TokenDistributionFacet
          file: ./abis/TokenDistributionFacet.json
        - name: InvestmentFacet
          file: ./abis/InvestmentFacet.json
        - name: WalletTypeFacet
          file: ./abis/WalletTypeFacet.json
        - name: TrustCoreFacet
          file: ./abis/TrustCoreFacet.json
        - name: TrustDistributionFacet
          file: ./abis/TrustDistributionFacet.json
        - name: TrustSuccessionFacet
          file: ./abis/TrustSuccessionFacet.json
        - name: WalletPaymasterPolicyFacet
          file: ./abis/WalletPaymasterPolicyFacet.json
        - name: WalletAccessManager
          file: ./abis/WalletAccessManagerFacet.json
        - name: AccessControl
          file: ./abis/AccessControlFacet.json
        - name: WalletRule701Facet
          file: ./abis/WalletRule701Facet.json
        - name: AssetDisposalFacet
          file: ./abis/AssetDisposalFacet.json
        - name: IncomeReceivableFacet
          file: ./abis/IncomeReceivableFacet.json
        - name: VehicleConfigFacet
          file: ./abis/VehicleConfigFacet.json
        - name: VaultAdapterFacet
          file: ./abis/VaultAdapterFacet.json
        - name: RedemptionControlFacet
          file: ./abis/RedemptionControlFacet.json
        - name: GovernanceCoreFacet
          file: ./abis/GovernanceCoreFacet.json
        - name: GovernanceVoteFacet
          file: ./abis/GovernanceVoteFacet.json
        - name: GovernanceExecuteFacet
          file: ./abis/GovernanceExecuteFacet.json
        - name: GovernanceConfigFacet
          file: ./abis/GovernanceConfigFacet.json
      eventHandlers:
        # Rule 701 events
        - event: EquityTokenRegistered(indexed address,string)
          handler: handleEquityTokenRegistered
        - event: EquityTokenUnregistered(indexed address)
          handler: handleEquityTokenUnregistered
        - event: CompanyMetricsUpdated(uint256,uint256,bytes32)
          handler: handleCompanyMetricsUpdated
        - event: Rule701GrantRegistered(indexed uint256,indexed address,indexed address,address,uint256,string,uint256)
          handler: handleRule701GrantRegistered
        - event: DisclosureProvided(bytes32)
          handler: handleDisclosureProvided
        # Diamond upgrade tracking (ERC-8109 declarative upgrades)
        - event: DiamondFunctionAdded(indexed bytes4,indexed address)
          handler: handleDiamondFunctionAdded
          receipt: false
        - event: DiamondFunctionReplaced(indexed bytes4,indexed address)
          handler: handleDiamondFunctionReplaced
          receipt: false
        - event: DiamondFunctionRemoved(indexed bytes4)
          handler: handleDiamondFunctionRemoved
          receipt: false
        - event: UserRoleUpdated(indexed address,indexed uint8,bool)
          handler: handleUserRoleUpdated
          receipt: false
        - event: FunctionAccessChanged(indexed bytes4,indexed uint8,bool)
          handler: handleWalletFunctionAccessChanged
          receipt: false
        - event: WalletTargetFunctionRoleSet(indexed address,indexed bytes4,uint8)
          handler: handleWalletTargetFunctionRoleSet
        - event: WalletInitialized(indexed address,string)
          handler: handleWalletInitialized
        - event: DocumentUploaded(indexed bytes32,indexed bytes32,indexed address)
          handler: handleDocumentUploaded
          receipt: true
        - event: DocumentCreated(indexed bytes32,indexed address,string,address[],string)
          handler: handleDocumentCreated
          receipt: true
        - event: DocumentSigned(indexed bytes32,indexed address,uint256)
          handler: handleDocumentSigned
          receipt: true
        - event: AttestationAdded(indexed bytes32,indexed string,uint256)
          handler: handleAttestationAdded
        - event: AttestationRevoked(indexed bytes32,uint256)
          handler: handleAttestationRevoked
        # Entity Classification events (from WalletTypeFacet)
        - event: EntityTypeSet(indexed bytes4,indexed bytes2,string)
          handler: handleEntityTypeSet
          receipt: false
        - event: LEISet(indexed bytes20)
          handler: handleLEISet
          receipt: false
        # VehicleConfig events (from VehicleConfigFacet)
        - event: VehicleConfigInitialized(uint8,bool)
          handler: handleVehicleConfigInitialized
          receipt: false
        - event: FundingModeSet(indexed uint8,indexed uint8)
          handler: handleFundingModeSet
          receipt: false
        - event: OpenEndedSet(bool,bool)
          handler: handleOpenEndedSet
          receipt: false
        # CapitalCall events (from CapitalCallFacet)
        - event: CapitalCallCreated(indexed uint256,uint256,uint256,bytes32,indexed address)
          handler: handleCapitalCallCreated
          receipt: false
        - event: ContributionReceived(indexed uint256,indexed address,uint256,bool)
          handler: handleContributionReceived
          receipt: false
        - event: CapitalCallCancelled(indexed uint256)
          handler: handleCapitalCallCancelled
          receipt: false
        - event: CapitalCallFunded(indexed uint256,uint256)
          handler: handleCapitalCallFunded
          receipt: false
        - event: CommitmentCalculated(indexed uint256,indexed address,uint256,uint256)
          handler: handleCommitmentCalculated
          receipt: false
        - event: CommitmentsTransferred(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleCommitmentsTransferred
          receipt: false
        # Commitment events (from CommitmentFacet - mint-at-funding model)
        - event: CommitmentCreated(indexed bytes32,indexed address,uint256,uint256)
          handler: handleCommitmentCreated
          receipt: false
        - event: CommitmentAccepted(indexed bytes32,indexed address,uint256)
          handler: handleCommitmentAccepted
          receipt: false
        - event: CommitmentCancelled(indexed bytes32,indexed address,string,uint256)
          handler: handleCommitmentCancelled
          receipt: false
        - event: CommitmentDefaulted(indexed bytes32,indexed address,uint256,uint256)
          handler: handleCommitmentDefaulted
          receipt: false
        - event: CapitalFunded(indexed bytes32,indexed address,uint256,uint256,uint256)
          handler: handleCapitalFundedFromCommitment
          receipt: false
        - event: CommitmentAdjusted(indexed bytes32,indexed address,uint256,uint256,string)
          handler: handleCommitmentAdjusted
          receipt: false
        # FeeAccrual events (from FeeAccrualFacet - management fees and carry)
        - event: FeeConfigUpdated(uint256,uint256,uint256,address,uint8)
          handler: handleFeeConfigUpdated
          receipt: false
        - event: ManagementFeeAccrued(uint256,uint256,uint256,uint256)
          handler: handleManagementFeeAccrued
          receipt: false
        - event: FeeSettled(uint256,address)
          handler: handleFeeSettled
          receipt: false
        - event: CarryCalculated(uint256,uint256,uint256,address)
          handler: handleCarryCalculated
          receipt: false
        # TokenDistribution events (from TokenDistributionFacet)
        - event: DistributionCreated(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleTokenDistributionCreated
          receipt: false
        - event: DistributionClaimed(indexed uint256,indexed address,uint256)
          handler: handleTokenDistributionClaimed
          receipt: false
        - event: DistributionCancelled(indexed uint256,uint256)
          handler: handleTokenDistributionCancelled
          receipt: false
        # Investment events (from InvestmentFacet)
        - event: InvestmentCreated(indexed uint256,indexed address,uint8,string)
          handler: handleInvestmentCreated
          receipt: false
        - event: InvestmentExecuted(indexed uint256,uint256,uint256)
          handler: handleInvestmentExecuted
          receipt: false
        - event: ValuationUpdated(indexed uint256,uint256,uint256,uint256)
          handler: handleValuationUpdated
          receipt: false
        - event: InvestmentExited(indexed uint256,uint256,uint256,uint256)
          handler: handleInvestmentExited
          receipt: false
        # Asset Disposal events (from AssetDisposalFacet)
        - event: AssetDisposed(indexed address,indexed address,bytes32[],uint256[],uint256,indexed address,address,uint256,uint256,uint8,uint8)
          handler: handleAssetDisposed
          receipt: false
        - event: WashSaleDetected(indexed address,indexed address,uint256,uint256,uint256,uint256)
          handler: handleWashSaleDetected
          receipt: false
        # Income Receivable events (from IncomeReceivableFacet)
        - event: IncomeReceived(indexed address,indexed address,indexed address,uint256,uint8,string,uint256)
          handler: handleIncomeReceived
          receipt: false
        # LienHolder events (from LienHolderFacet)
        - event: LienGranted(indexed bytes32,indexed address,address[],uint256,uint256)
          handler: handleLienGranted
          receipt: false
        - event: LienReleased(indexed bytes32,indexed address)
          handler: handleLienReleased
          receipt: false
        - event: LienRevoked(indexed bytes32,indexed address)
          handler: handleLienRevoked
          receipt: false
        - event: WalletFrozen(indexed bytes32,indexed address,string)
          handler: handleWalletFrozen
          receipt: false
        - event: WalletUnfrozen(indexed bytes32,indexed address)
          handler: handleWalletUnfrozen
          receipt: false
        - event: AssetsSeized(indexed bytes32,indexed address,uint256,address,string)
          handler: handleAssetsSeized
          receipt: false
        # Trust Core events (from TrustCoreFacet)
        - event: TrustInitialized(uint8,indexed address,indexed address,bool)
          handler: handleTrustInitialized
          receipt: false
        - event: TrustStatusChanged(uint8,uint8)
          handler: handleTrustStatusChanged
          receipt: false
        - event: TrustRevoked(indexed address,uint256)
          handler: handleTrustRevoked
          receipt: false
        - event: ParticipantAdded(indexed address,uint8,uint256,string)
          handler: handleParticipantAdded
          receipt: false
        - event: ParticipantRemoved(indexed address,uint8)
          handler: handleParticipantRemoved
          receipt: false
        - event: BeneficiaryShareUpdated(indexed address,uint256,uint256)
          handler: handleBeneficiaryShareUpdated
          receipt: false
        # Trust Distribution events (from TrustDistributionFacet)
        - event: ClaimableDistributionCreated(indexed uint256,uint8,indexed address,indexed address,uint256)
          handler: handleTrustClaimableDistributionCreated
          receipt: false
        - event: DistributionScheduleCreated(indexed address,uint256,uint256,uint256,uint8)
          handler: handleDistributionScheduleCreated
          receipt: false
        - event: DistributionScheduleRevoked(indexed address,indexed address)
          handler: handleDistributionScheduleRevoked
          receipt: false
        - event: VestedAmountReleased(indexed address,uint256,uint256,uint256)
          handler: handleVestedAmountReleased
          receipt: false
        - event: MilestoneCreated(indexed bytes32,indexed address,string,uint256)
          handler: handleMilestoneCreated
          receipt: false
        - event: MilestoneAchieved(indexed bytes32,indexed address,indexed address,uint256)
          handler: handleMilestoneAchieved
          receipt: false
        # Paymaster policy events (from WalletPaymasterPolicyFacet ABI)
        - event: PaymasterEnabled(bool)
          handler: handlePaymasterEnabled
          receipt: false
        - event: DailyBudgetSet(uint256)
          handler: handleDailyBudgetSet
          receipt: false
        - event: PaymasterAddressSet(indexed address)
          handler: handlePaymasterAddressSet
          receipt: false
        - event: RolePolicySet(indexed uint8,bool,uint256)
          handler: handleRolePolicySet
          receipt: false
        - event: SpendingRecorded(indexed address,uint256)
          handler: handleSpendingRecorded
          receipt: false
        # Native asset transfer tracking
        - event: TransactionExecuted(indexed address,uint256,bytes)
          handler: handleTransactionExecuted
          receipt: false
        - event: EtherReceived(indexed address,uint256)
          handler: handleEtherReceived
          receipt: false
        # Authorized Signer events (role-limited signers)
        - event: SignerAdded(indexed bytes32,indexed uint8,uint8,uint48,string)
          handler: handleSignerAdded
          receipt: false
        - event: SignerRemoved(indexed bytes32,indexed address)
          handler: handleSignerRemoved
          receipt: false
        - event: SignerRoleUpdated(indexed bytes32,uint8,uint8)
          handler: handleSignerRoleUpdated
          receipt: false
        - event: SignerExpiryUpdated(indexed bytes32,uint48,uint48)
          handler: handleSignerExpiryUpdated
          receipt: false
        - event: SignerSuspended(indexed bytes32,indexed address)
          handler: handleSignerSuspended
          receipt: false
        - event: SignerReinstated(indexed bytes32,indexed address)
          handler: handleSignerReinstated
          receipt: false
        # UserOperation Execution audit trail
        - event: UserOperationExecuted(indexed bytes32,indexed bytes32,uint8,address,bytes4,bool)
          handler: handleUserOperationExecuted
          receipt: false
        # DeFi Integration events (Treasury/Yield management)
        - event: VaultRegistered(indexed address,indexed address,string)
          handler: handleVaultRegistered
          receipt: false
        - event: VaultUnregistered(indexed address)
          handler: handleVaultUnregistered
          receipt: false
        - event: VaultDeposit(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleVaultDeposit
          receipt: false
        - event: VaultWithdrawal(indexed uint256,indexed address,uint256,uint256,uint256,bool)
          handler: handleVaultWithdrawal
          receipt: false
        - event: VaultValuationUpdated(indexed uint256,indexed address,uint256,uint256)
          handler: handleVaultValuationUpdated
          receipt: false
        # Redemption Control events
        - event: RedemptionRequested(indexed uint256,indexed address,uint256,uint256)
          handler: handleRedemptionRequested
          receipt: false
        - event: RedemptionProcessed(indexed uint256,indexed address,uint256,uint256,uint256)
          handler: handleRedemptionProcessed
          receipt: false
        - event: RedemptionCancelled(indexed uint256,indexed address,string)
          handler: handleRedemptionCancelled
          receipt: false
        - event: RedemptionsSuspended(indexed uint8,string,indexed address)
          handler: handleRedemptionsSuspended
          receipt: false
        - event: RedemptionsResumed(indexed address)
          handler: handleRedemptionsResumed
          receipt: false
        - event: SidePocketCreated(indexed uint256,indexed uint256,string)
          handler: handleSidePocketCreated
          receipt: false
        - event: SidePocketDistributed(indexed uint256,uint256,uint256)
          handler: handleSidePocketDistributed
          receipt: false
        - event: GatePeriodReset(uint256,uint256,uint256)
          handler: handleGatePeriodReset
          receipt: false
        # Governance events (from GovernanceCoreFacet, GovernanceVoteFacet, GovernanceExecuteFacet, GovernanceConfigFacet)
        - event: GovernanceInitialized(indexed address,uint256,uint32,uint32)
          handler: handleGovernanceInitialized
          receipt: false
        - event: ProposalCreated(indexed uint256,indexed bytes32,indexed address,address[],uint256[],bytes[],uint256,uint256,string)
          handler: handleProposalCreated
          receipt: false
        - event: ProposalCanceled(indexed uint256,indexed address)
          handler: handleProposalCanceled
          receipt: false
        - event: VoteCast(indexed address,indexed uint256,indexed uint8,uint256,string)
          handler: handleVoteCast
          receipt: false
        - event: ProposalQueued(indexed uint256,uint256)
          handler: handleProposalQueued
          receipt: false
        - event: ProposalExecuted(indexed uint256)
          handler: handleProposalExecuted
          receipt: false
        - event: ProposalVetoed(indexed uint256,indexed address)
          handler: handleProposalVetoed
          receipt: false
        - event: ProposalTypeRegistered(indexed bytes32,string,uint16,uint16)
          handler: handleProposalTypeRegistered
          receipt: false
        - event: ProposalTypeUpdated(indexed bytes32)
          handler: handleProposalTypeUpdated
          receipt: false
        - event: SecondTierProposalCreated(indexed uint256,indexed uint256,indexed bytes32)
          handler: handleSecondTierProposalCreated
          receipt: false
      file: ./src/mappings/wallets.ts

  # Escrow Diamond Template
  - kind: ethereum/contract
    name: EscrowDiamond
    network: base
    source:
      abi: AcquisitionCoreFacet
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Escrow
      abis:
        - name: AcquisitionDiamond
          file: ./abis/AcquisitionDiamond.json
        - name: AcquisitionCoreFacet
          file: ./abis/AcquisitionCoreFacet.json
      eventHandlers:
        - event: AcquisitionListed(uint256)
          handler: handleEscrowActivated
        - event: AcquisitionCancelled()
          handler: handleEscrowCancelled
        - event: OfferAccepted(indexed address)
          handler: handleOfferAccepted
        - event: DisputeRaised(indexed address)
          handler: handleDisputeRaised
      file: ./src/mappings/escrows.ts

  # NOTE: Rule144ComplianceModule template removed - replaced by modular HoldingPeriodModule, VolumeLimitModule, AffiliateStatusModule

  # Holding Period Module Template
  - kind: ethereum/contract
    name: HoldingPeriodModule
    network: base
    source:
      abi: HoldingPeriodModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - HoldingPeriodConfig
        - Token
      abis:
        - name: HoldingPeriodModule
          file: ./abis/HoldingPeriodModule.json
      eventHandlers:
        - event: HoldingPeriodSet(indexed address,uint256)
          handler: handleHoldingPeriodSet
        - event: AcquisitionDateSet(indexed address,indexed bytes32,indexed address,uint256)
          handler: handleAcquisitionDateSet
        - event: AcquisitionDateUpdated(indexed address,indexed bytes32,indexed address,uint256)
          handler: handleAcquisitionDateUpdated
      file: ./src/mappings/holding-period-module.ts

  # Volume Limit Module Template
  - kind: ethereum/contract
    name: VolumeLimitModule
    network: base
    source:
      abi: VolumeLimitModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - VolumeLimitConfig
        - Token
      abis:
        - name: VolumeLimitModule
          file: ./abis/VolumeLimitModule.json
      eventHandlers:
        - event: VolumeConfigSet(indexed address,uint256,uint256,bool)
          handler: handleVolumeConfigSet
        - event: VolumeRecorded(indexed address,indexed address,uint256,uint256)
          handler: handleVolumeRecorded
        - event: WindowReset(indexed address,indexed address,uint256)
          handler: handleWindowReset
      file: ./src/mappings/volume-limit-module.ts

  # Affiliate Status Module Template
  - kind: ethereum/contract
    name: AffiliateStatusModule
    network: base
    source:
      abi: AffiliateStatusModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ComplianceModule
        - AffiliateStatus
        - AffiliateStatusChange
        - Token
      abis:
        - name: AffiliateStatusModule
          file: ./abis/AffiliateStatusModule.json
      eventHandlers:
        - event: AffiliateStatusSet(indexed address,indexed address,bool)
          handler: handleAffiliateStatusSet
        - event: AffiliateStatusBatchSet(indexed address,uint256)
          handler: handleAffiliateStatusBatchSet
      file: ./src/mappings/affiliate-status-module.ts

  # Lockup Compliance Module Template (Lot-level)
  - kind: ethereum/contract
    name: LockupComplianceModule
    network: base
    source:
      abi: LockupComplianceModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - LockupConfig
      abis:
        - name: LockupComplianceModule
          file: ./abis/LockupComplianceModule.json
      eventHandlers:
        - event: LockupSet(indexed bytes32,uint256)
          handler: handleLockupSet
        - event: LockupExtended(indexed bytes32,uint256,uint256)
          handler: handleLockupExtended
        - event: LockupRemoved(indexed bytes32)
          handler: handleLockupRemoved
      file: ./src/mappings/lockup-module.ts

  # Vesting Compliance Module Template (Lot-level)
  - kind: ethereum/contract
    name: VestingComplianceModule
    network: base
    source:
      abi: VestingComplianceModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - VestingConfig
      abis:
        - name: VestingComplianceModule
          file: ./abis/VestingComplianceModule.json
      eventHandlers:
        - event: VestingScheduleCreated(indexed address,indexed bytes32,uint256,uint256,uint256,uint256,bool)
          handler: handleVestingScheduleCreated
        - event: TokensReleased(indexed address,indexed bytes32,uint256)
          handler: handleTokensReleased
        - event: VestingScheduleRevoked(indexed address,indexed bytes32)
          handler: handleVestingScheduleRevoked
      file: ./src/mappings/vesting-module.ts

  # ROFR (Right of First Refusal) Module Template
  - kind: ethereum/contract
    name: ROFRModule
    network: base
    source:
      abi: ROFRModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ROFRTransferRequest
      abis:
        - name: ROFRModule
          file: ./abis/ROFRModule.json
      eventHandlers:
        - event: TransferRequested(indexed uint256,indexed address,indexed address,uint256,uint256,address)
          handler: handleTransferRequested
        - event: ROFRPeriodStarted(indexed uint256,uint256,uint256)
          handler: handleROFRPeriodStarted
        - event: ROFRExercised(indexed uint256,indexed address,indexed address)
          handler: handleROFRExercised
        - event: TransferApproved(indexed uint256,address)
          handler: handleTransferApproved
        - event: TransferRejected(indexed uint256,string)
          handler: handleTransferRejected
        - event: TransferCompleted(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleTransferCompleted
        - event: TransferCancelled(indexed uint256)
          handler: handleTransferCancelled
      file: ./src/mappings/rofr-module.ts

  # Minimum Balance Module Template
  - kind: ethereum/contract
    name: MinimumBalanceModule
    network: base
    source:
      abi: MinimumBalanceModule
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - MinimumBalanceConfig
        - MinimumBalanceExemption
      abis:
        - name: MinimumBalanceModule
          file: ./abis/MinimumBalanceModule.json
      eventHandlers:
        - event: MinimumBalanceSet(indexed address,uint256)
          handler: handleMinimumBalanceSet
        - event: MinimumBalanceExemptionSet(indexed address,indexed address,bool)
          handler: handleMinimumBalanceExemptionSet
        - event: AutoExemptRoleSet(indexed address,uint8,bool)
          handler: handleAutoExemptRoleSet
      file: ./src/mappings/minimum-balance-module.ts
